{"version":3,"sources":["src/pages/project/promotions/edit/index.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport {\r\n  PageContainer,\r\n  ProCard,\r\n  ProForm,\r\n  ProFormDatePicker,\r\n  ProFormDigit,\r\n  ProFormSelect,\r\n  ProFormText,\r\n  ProFormTextArea,\r\n} from '@ant-design/pro-components';\r\nimport { Spin, message } from 'antd';\r\nimport { history, useParams } from '@umijs/max';\r\nimport dayjs from 'dayjs';\r\n\r\ntype Promotion = {\r\n  id: number;\r\n  duAn: string;\r\n  tenChuongTrinh: string;\r\n  tenQuaTang: string;\r\n  keHoachBanHang: string;\r\n  tuNGay: string;\r\n  denNgay: string;\r\n  tyLe: string;\r\n  tienMat: string;\r\n  nhanVienTao: string;\r\n  ngayTao: string;\r\n  nhanVienCapNhat: string;\r\n  ngayCapNhat: string;\r\n};\r\n\r\nconst MOCK_PROMOTIONS: Promotion[] = [\r\n  {\r\n    id: 1,\r\n    duAn: 'Dự án A',\r\n    tenChuongTrinh: 'KM Mùa hè',\r\n    tenQuaTang: 'Voucher 100k',\r\n    keHoachBanHang: 'Bán trực tiếp, online',\r\n    tuNGay: '2025-06-01',\r\n    denNgay: '2025-06-30',\r\n    tyLe: '10%',\r\n    tienMat: '100000',\r\n    nhanVienTao: 'Nguyễn A',\r\n    ngayTao: '2025-05-20',\r\n    nhanVienCapNhat: 'Trần B',\r\n    ngayCapNhat: '2025-05-25',\r\n  },\r\n];\r\n\r\nasync function fetchPromotionById(id: number): Promise<Promotion | null> {\r\n  await new Promise((r) => setTimeout(r, 200));\r\n  return MOCK_PROMOTIONS.find((p) => p.id === id) ?? null;\r\n}\r\n\r\nasync function updatePromotion(id: number, payload: Partial<Promotion>) {\r\n  await new Promise((r) => setTimeout(r, 200));\r\n  console.log('Update promotion', { id, payload });\r\n  return true;\r\n}\r\n\r\nconst PromotionEdit: React.FC = () => {\r\n  const params = useParams<{ id: string }>();\r\n  const promotionId = useMemo(() => Number(params.id), [params.id]);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [initialValues, setInitialValues] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    const run = async () => {\r\n      if (!Number.isFinite(promotionId)) {\r\n        message.error('ID không hợp lệ');\r\n        history.push('/project/promotions');\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      try {\r\n        const res = await fetchPromotionById(promotionId);\r\n        if (cancelled) return;\r\n\r\n        if (!res) {\r\n          message.warning('Không tìm thấy chương trình');\r\n          history.push('/project/promotions');\r\n          return;\r\n        }\r\n\r\n        setInitialValues({\r\n          ...res,\r\n          tuNGay: dayjs(res.tuNGay),\r\n          denNgay: dayjs(res.denNgay),\r\n        });\r\n      } catch {\r\n        if (!cancelled) message.error('Lỗi tải dữ liệu');\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [promotionId]);\r\n\r\n  const onFinish = async (values: any) => {\r\n    const payload = {\r\n      ...values,\r\n      tuNGay: values.tuNGay.format('YYYY-MM-DD'),\r\n      denNgay: values.denNgay.format('YYYY-MM-DD'),\r\n    };\r\n\r\n    await updatePromotion(promotionId, payload);\r\n    message.success('Cập nhật thành công');\r\n    history.push(`/project/promotions/${promotionId}`);\r\n    return true;\r\n  };\r\n\r\n  return (\r\n    <PageContainer title=\"Sửa chương trình\" onBack={() => history.push(`/project/promotions/${promotionId}`)}>\r\n      <Spin spinning={loading}>\r\n        {initialValues && (\r\n          <ProCard>\r\n            <ProForm\r\n              layout=\"vertical\"\r\n              grid\r\n              colProps={{ span: 12 }}\r\n              initialValues={initialValues}\r\n              onFinish={onFinish}\r\n            >\r\n              <ProFormSelect\r\n                name=\"duAn\"\r\n                label=\"Dự án\"\r\n                valueEnum={{ 'Dự án A': { text: 'Dự án A' }, 'Dự án B': { text: 'Dự án B' } }}\r\n              />\r\n              <ProFormText name=\"tenChuongTrinh\" label=\"Tên chương trình\" rules={[{ required: true }]} />\r\n              <ProFormText name=\"tenQuaTang\" label=\"Quà tặng\" />\r\n              <ProFormTextArea name=\"keHoachBanHang\" label=\"Kế hoạch bán hàng\" colProps={{ span: 24 }} />\r\n              <ProFormDatePicker name=\"tuNGay\" label=\"Từ ngày\" />\r\n              <ProFormDatePicker name=\"denNgay\" label=\"Đến ngày\" />\r\n              <ProFormText name=\"tyLe\" label=\"Tỷ lệ\" />\r\n              <ProFormText name=\"tienMat\" label=\"Tiền mặt\" />\r\n            </ProForm>\r\n          </ProCard>\r\n        )}\r\n      </Spin>\r\n    </PageContainer>\r\n  );\r\n};\r\n\r\nexport default PromotionEdit;\r\n"],"names":[],"mappings":"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"}