{"version":3,"sources":["src/pages/project/project-edit/index.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport {\r\n  PageContainer,\r\n  ProCard,\r\n  ProForm,\r\n  ProFormDatePicker,\r\n  ProFormDigit,\r\n  ProFormSelect,\r\n  ProFormSwitch,\r\n  ProFormText,\r\n  ProFormTextArea,\r\n} from '@ant-design/pro-components';\r\nimport { Button, Spin, message } from 'antd';\r\nimport { history, useParams } from '@umijs/max';\r\nimport dayjs from 'dayjs';\r\n\r\ntype Project = {\r\n  id: number;\r\n  ngay: string;\r\n  code: string;\r\n  maFast: string;\r\n  tenDuAn: string;\r\n  loaiDuAn: string;\r\n  nhanVien: string;\r\n  dienTich: string; // bạn đang dùng \"120 m2\" => giữ string\r\n  soGiayPhep: string;\r\n  ngayCap: string;\r\n  donGia: string; // \"1,000,000\" => giữ string\r\n  soLuong: number;\r\n  diaChi: string;\r\n  ngayDuyet: string;\r\n  nguoiDuyet: string;\r\n  daDuyet: boolean;\r\n};\r\n\r\n// Mock data\r\nconst MOCK_PROJECTS: Project[] = [\r\n  {\r\n    id: 1,\r\n    ngay: '2025-01-01',\r\n    code: 'DA-001',\r\n    maFast: 'MF001',\r\n    tenDuAn: 'Dự án A',\r\n    loaiDuAn: 'Loại 1',\r\n    nhanVien: 'Nguyễn A',\r\n    dienTich: '120 m2',\r\n    soGiayPhep: 'GP-123',\r\n    ngayCap: '2024-12-01',\r\n    donGia: '1,000,000',\r\n    soLuong: 10,\r\n    diaChi: 'Hà Nội',\r\n    ngayDuyet: '2024-12-15',\r\n    nguoiDuyet: 'Ban QL',\r\n    daDuyet: true,\r\n  },\r\n  {\r\n    id: 2,\r\n    ngay: '2025-02-02',\r\n    code: 'DA-002',\r\n    maFast: 'MF002',\r\n    tenDuAn: 'Dự án B',\r\n    loaiDuAn: 'Loại 2',\r\n    nhanVien: 'Trần B',\r\n    dienTich: '80 m2',\r\n    soGiayPhep: 'GP-456',\r\n    ngayCap: '2024-11-20',\r\n    donGia: '800,000',\r\n    soLuong: 5,\r\n    diaChi: 'Hồ Chí Minh',\r\n    ngayDuyet: '2024-11-30',\r\n    nguoiDuyet: 'BGĐ',\r\n    daDuyet: false,\r\n  },\r\n];\r\n\r\nasync function fetchProjectById(id: number): Promise<Project | null> {\r\n  await new Promise((r) => setTimeout(r, 200));\r\n  return MOCK_PROJECTS.find((p) => p.id === id) ?? null;\r\n}\r\n\r\n// mock update\r\nasync function updateProjectById(id: number, payload: Partial<Project>) {\r\n  await new Promise((r) => setTimeout(r, 200));\r\n  console.log('Update project', { id, payload });\r\n  return true;\r\n}\r\n\r\nconst ProjectEdit: React.FC = () => {\r\n  const params = useParams<{ id: string }>();\r\n  const projectId = useMemo(() => Number(params.id), [params.id]);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [initialValues, setInitialValues] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    const run = async () => {\r\n      if (!Number.isFinite(projectId) || projectId <= 0) {\r\n        message.error('ID dự án không hợp lệ');\r\n        history.push('/project/list');\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      try {\r\n        const res = await fetchProjectById(projectId);\r\n        if (cancelled) return;\r\n\r\n        if (!res) {\r\n          message.warning('Không tìm thấy dự án');\r\n          history.push('/project/list');\r\n          return;\r\n        }\r\n\r\n        // ProFormDatePicker cần dayjs object\r\n        setInitialValues({\r\n          ...res,\r\n          ngay: res.ngay ? dayjs(res.ngay) : undefined,\r\n          ngayCap: res.ngayCap ? dayjs(res.ngayCap) : undefined,\r\n          ngayDuyet: res.ngayDuyet ? dayjs(res.ngayDuyet) : undefined,\r\n        });\r\n      } catch (e) {\r\n        if (!cancelled) message.error('Lỗi tải dữ liệu dự án');\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [projectId]);\r\n\r\n  const onFinish = async (values: any) => {\r\n    // Convert dayjs -> string YYYY-MM-DD (đồng bộ mock data của bạn)\r\n    const payload: Partial<Project> = {\r\n      ...values,\r\n      ngay: values.ngay ? values.ngay.format('YYYY-MM-DD') : '',\r\n      ngayCap: values.ngayCap ? values.ngayCap.format('YYYY-MM-DD') : '',\r\n      ngayDuyet: values.ngayDuyet ? values.ngayDuyet.format('YYYY-MM-DD') : '',\r\n    };\r\n\r\n    await updateProjectById(projectId, payload);\r\n    message.success('Cập nhật dự án thành công (mock)');\r\n\r\n    // tuỳ bạn: về detail hoặc list\r\n    history.push(`/project/${projectId}`);\r\n    return true;\r\n  };\r\n\r\n  return (\r\n    <PageContainer\r\n      title=\"Sửa dự án\"\r\n      onBack={() => history.push(`/project/${projectId}`)}\r\n      extra={[\r\n        <Button key=\"back\" onClick={() => history.push(`/project/${projectId}`)}>\r\n          Quay lại chi tiết\r\n        </Button>,\r\n      ]}\r\n    >\r\n      <Spin spinning={loading}>\r\n        {initialValues ? (\r\n          <ProCard>\r\n            <ProForm\r\n              layout=\"vertical\"\r\n              grid\r\n              colProps={{ span: 12 }}\r\n              initialValues={initialValues}\r\n              onFinish={onFinish}\r\n              submitter={{\r\n                searchConfig: { submitText: 'Cập nhật', resetText: 'Hủy' },\r\n                resetButtonProps: {\r\n                  onClick: (e) => {\r\n                    e.preventDefault();\r\n                    history.push(`/project/${projectId}`);\r\n                  },\r\n                },\r\n              }}\r\n            >\r\n              <ProFormText name=\"code\" label=\"Mã\" rules={[{ required: true, message: 'Vui lòng nhập mã' }]} />\r\n              <ProFormText name=\"maFast\" label=\"Mã Fast\" />\r\n\r\n              <ProFormText\r\n                name=\"tenDuAn\"\r\n                label=\"Tên dự án\"\r\n                colProps={{ span: 24 }}\r\n                rules={[{ required: true, message: 'Vui lòng nhập tên dự án' }]}\r\n              />\r\n\r\n              <ProFormSelect\r\n                name=\"loaiDuAn\"\r\n                label=\"Loại dự án\"\r\n                valueEnum={{\r\n                  'Loại 1': { text: 'Loại 1' },\r\n                  'Loại 2': { text: 'Loại 2' },\r\n                }}\r\n              />\r\n\r\n              <ProFormText name=\"nhanVien\" label=\"Nhân viên\" />\r\n\r\n              <ProFormTextArea\r\n                name=\"diaChi\"\r\n                label=\"Địa chỉ\"\r\n                colProps={{ span: 24 }}\r\n                fieldProps={{ rows: 2 }}\r\n              />\r\n\r\n              <ProFormDatePicker name=\"ngay\" label=\"Ngày\" fieldProps={{ format: 'YYYY-MM-DD' }} />\r\n\r\n              <ProFormText name=\"dienTich\" label=\"Diện tích\" placeholder=\"VD: 120 m2\" />\r\n              <ProFormText name=\"soGiayPhep\" label=\"Số giấy phép\" />\r\n\r\n              <ProFormDatePicker name=\"ngayCap\" label=\"Ngày cấp\" fieldProps={{ format: 'YYYY-MM-DD' }} />\r\n\r\n              <ProFormText name=\"donGia\" label=\"Đơn giá\" placeholder=\"VD: 1,000,000\" />\r\n              <ProFormDigit name=\"soLuong\" label=\"Số lượng\" min={0} fieldProps={{ precision: 0 }} />\r\n\r\n              <ProFormSwitch\r\n                name=\"daDuyet\"\r\n                label=\"Đã duyệt\"\r\n                fieldProps={{ checkedChildren: 'Đã duyệt', unCheckedChildren: 'Chưa duyệt' }}\r\n              />\r\n\r\n              <ProFormDatePicker\r\n                name=\"ngayDuyet\"\r\n                label=\"Ngày duyệt\"\r\n                fieldProps={{ format: 'YYYY-MM-DD' }}\r\n              />\r\n\r\n              <ProFormText name=\"nguoiDuyet\" label=\"Người duyệt\" />\r\n            </ProForm>\r\n          </ProCard>\r\n        ) : null}\r\n      </Spin>\r\n    </PageContainer>\r\n  );\r\n};\r\n\r\nexport default ProjectEdit;\r\n"],"names":[],"mappings":"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"}