{"version":3,"sources":["src/pages/product/sale/edit/index.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport {\r\n  PageContainer,\r\n  ProCard,\r\n  ProForm,\r\n  ProFormDatePicker,\r\n  ProFormDigit,\r\n  ProFormSelect,\r\n  ProFormText,\r\n} from '@ant-design/pro-components';\r\nimport { Button, Spin, message } from 'antd';\r\nimport { history, useParams } from '@umijs/max';\r\nimport dayjs from 'dayjs';\r\n\r\ntype SalePhase = {\r\n  id: string;\r\n  quyetDinh: string;\r\n  duAn: string;\r\n  dot: string;\r\n  ngayBatDau: string;\r\n  ngayKetThuc: string;\r\n  thoiGianGiao: string;\r\n  soNguoi: number;\r\n  dienGia: string;\r\n  donGia: string;\r\n};\r\n\r\n// Mock data\r\nconst MOCK_SALES: SalePhase[] = [\r\n  {\r\n    id: 'S-001',\r\n    quyetDinh: 'QD-01',\r\n    duAn: 'Dự án A',\r\n    dot: 'Đợt 1',\r\n    ngayBatDau: '2025-06-01',\r\n    ngayKetThuc: '2025-06-30',\r\n    thoiGianGiao: '30 ngày',\r\n    soNguoi: 5,\r\n    dienGia: '1,000,000',\r\n    donGia: '900,000',\r\n  },\r\n  {\r\n    id: 'S-002',\r\n    quyetDinh: 'QD-02',\r\n    duAn: 'Dự án B',\r\n    dot: 'Đợt 2',\r\n    ngayBatDau: '2025-07-01',\r\n    ngayKetThuc: '2025-07-15',\r\n    thoiGianGiao: '15 ngày',\r\n    soNguoi: 3,\r\n    dienGia: '800,000',\r\n    donGia: '750,000',\r\n  },\r\n];\r\n\r\nasync function fetchSaleById(id: string): Promise<SalePhase | null> {\r\n  await new Promise((r) => setTimeout(r, 200));\r\n  return MOCK_SALES.find((x) => x.id === id) ?? null;\r\n}\r\n\r\nasync function updateSaleById(id: string, payload: Partial<SalePhase>) {\r\n  await new Promise((r) => setTimeout(r, 200));\r\n  console.log('Update sale', { id, payload });\r\n  return true;\r\n}\r\n\r\nconst ProductSaleEdit: React.FC = () => {\r\n  const params = useParams<{ id?: string }>();\r\n  const saleId = useMemo(() => (params.id ?? '').trim(), [params.id]);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [initialValues, setInitialValues] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    const run = async () => {\r\n      if (!saleId) {\r\n        message.error('ID không hợp lệ');\r\n        history.push('/product/sale');\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      try {\r\n        const res = await fetchSaleById(saleId);\r\n        if (cancelled) return;\r\n\r\n        if (!res) {\r\n          message.warning('Không tìm thấy đợt mở bán');\r\n          history.push('/product/sale');\r\n          return;\r\n        }\r\n\r\n        setInitialValues({\r\n          ...res,\r\n          ngayBatDau: res.ngayBatDau ? dayjs(res.ngayBatDau) : undefined,\r\n          ngayKetThuc: res.ngayKetThuc ? dayjs(res.ngayKetThuc) : undefined,\r\n        });\r\n      } catch {\r\n        if (!cancelled) message.error('Lỗi tải dữ liệu');\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [saleId]);\r\n\r\n  const onFinish = async (values: any) => {\r\n    const payload: Partial<SalePhase> = {\r\n      ...values,\r\n      ngayBatDau: values.ngayBatDau ? values.ngayBatDau.format('YYYY-MM-DD') : '',\r\n      ngayKetThuc: values.ngayKetThuc ? values.ngayKetThuc.format('YYYY-MM-DD') : '',\r\n    };\r\n\r\n    await updateSaleById(saleId, payload);\r\n    message.success('Cập nhật thành công (mock)');\r\n    history.push(`/product/sale/${saleId}`);\r\n    return true;\r\n  };\r\n\r\n  return (\r\n    <PageContainer\r\n      title=\"Sửa đợt mở bán\"\r\n      onBack={() => history.push(`/product/sale/${saleId}`)}\r\n      extra={[\r\n        <Button key=\"detail\" onClick={() => history.push(`/product/sale/${saleId}`)}>\r\n          Quay lại chi tiết\r\n        </Button>,\r\n      ]}\r\n    >\r\n      <Spin spinning={loading}>\r\n        {initialValues && (\r\n          <ProCard>\r\n            <ProForm\r\n              layout=\"vertical\"\r\n              grid\r\n              colProps={{ span: 12 }}\r\n              initialValues={initialValues}\r\n              onFinish={onFinish}\r\n              submitter={{\r\n                searchConfig: { submitText: 'Cập nhật', resetText: 'Huỷ' },\r\n                resetButtonProps: {\r\n                  onClick: (e) => {\r\n                    e.preventDefault();\r\n                    history.push(`/product/sale/${saleId}`);\r\n                  },\r\n                },\r\n              }}\r\n            >\r\n              <ProFormText name=\"id\" label=\"ID\" disabled />\r\n              <ProFormText name=\"quyetDinh\" label=\"Quyết định\" rules={[{ required: true }]} />\r\n              <ProFormSelect\r\n                name=\"duAn\"\r\n                label=\"Dự án\"\r\n                rules={[{ required: true }]}\r\n                valueEnum={{\r\n                  'Dự án A': { text: 'Dự án A' },\r\n                  'Dự án B': { text: 'Dự án B' },\r\n                }}\r\n              />\r\n              <ProFormText name=\"dot\" label=\"Đợt\" rules={[{ required: true }]} />\r\n\r\n              <ProFormDatePicker name=\"ngayBatDau\" label=\"Ngày bắt đầu\" fieldProps={{ format: 'YYYY-MM-DD' }} />\r\n              <ProFormDatePicker name=\"ngayKetThuc\" label=\"Ngày kết thúc\" fieldProps={{ format: 'YYYY-MM-DD' }} />\r\n\r\n              <ProFormText name=\"thoiGianGiao\" label=\"Thời gian giao\" placeholder=\"VD: 30 ngày\" />\r\n\r\n              <ProFormDigit\r\n                name=\"soNguoi\"\r\n                label=\"Số người\"\r\n                min={0}\r\n                fieldProps={{ precision: 0 }}\r\n              />\r\n\r\n              <ProFormText name=\"dienGia\" label=\"Diện giá\" placeholder=\"VD: 1,000,000\" />\r\n              <ProFormText name=\"donGia\" label=\"Đơn giá\" placeholder=\"VD: 900,000\" />\r\n            </ProForm>\r\n          </ProCard>\r\n        )}\r\n      </Spin>\r\n    </PageContainer>\r\n  );\r\n};\r\n\r\nexport default ProductSaleEdit;\r\n"],"names":[],"mappings":"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"}