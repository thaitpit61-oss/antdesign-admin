{"version":3,"sources":["src/pages/product/edit/index.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { PageContainer, ProCard, ProForm, ProFormSelect, ProFormText } from '@ant-design/pro-components';\r\nimport { Button, Spin, message } from 'antd';\r\nimport { history, useParams } from 'umi';\r\n\r\ntype Product = {\r\n  stt: number;\r\n  trangThai: 'Available' | 'Sold' | string;\r\n  maCan: string;\r\n  duAn: string;\r\n  dotBanHang: string;\r\n  loaiSP: string;\r\n  tang: string;\r\n  dienTich: string;\r\n  donGia: string;\r\n  tongGia: string;\r\n  chietKhau: string;\r\n  tongSauCK: string;\r\n};\r\n\r\n// Mock data (giống bên detail)\r\nconst MOCK_PRODUCTS: Product[] = [\r\n  {\r\n    stt: 1,\r\n    trangThai: 'Available',\r\n    maCan: 'C-001',\r\n    duAn: 'Dự án A',\r\n    dotBanHang: 'Đợt 1',\r\n    loaiSP: 'Căn hộ',\r\n    tang: 'Tầng 5',\r\n    dienTich: '75 m2',\r\n    donGia: '1,200,000',\r\n    tongGia: '90,000,000',\r\n    chietKhau: '5%',\r\n    tongSauCK: '85,500,000',\r\n  },\r\n  {\r\n    stt: 2,\r\n    trangThai: 'Sold',\r\n    maCan: 'C-002',\r\n    duAn: 'Dự án B',\r\n    dotBanHang: 'Đợt 2',\r\n    loaiSP: 'Studio',\r\n    tang: 'Tầng 3',\r\n    dienTich: '40 m2',\r\n    donGia: '900,000',\r\n    tongGia: '36,000,000',\r\n    chietKhau: '0%',\r\n    tongSauCK: '36,000,000',\r\n  },\r\n];\r\n\r\n// mock “API”\r\nasync function fetchProductByMaCan(maCan: string): Promise<Product | null> {\r\n  await new Promise((r) => setTimeout(r, 200));\r\n  return MOCK_PRODUCTS.find((p) => p.maCan === maCan) ?? null;\r\n}\r\n\r\nasync function updateProductByMaCan(maCan: string, payload: Partial<Product>) {\r\n  await new Promise((r) => setTimeout(r, 200));\r\n  console.log('Update product', { maCan, payload });\r\n  return true;\r\n}\r\n\r\nconst ProductEdit: React.FC = () => {\r\n  const params = useParams<{ maCan?: string }>();\r\n  const maCan = useMemo(() => (params.maCan ?? '').trim(), [params.maCan]);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [initialValues, setInitialValues] = useState<Product | null>(null);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    const run = async () => {\r\n      if (!maCan) {\r\n        message.error('Mã căn không hợp lệ');\r\n        history.push('/product/list');\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      try {\r\n        const res = await fetchProductByMaCan(maCan);\r\n        if (cancelled) return;\r\n\r\n        if (!res) {\r\n          message.warning('Không tìm thấy sản phẩm');\r\n          history.push('/product/list');\r\n          return;\r\n        }\r\n\r\n        setInitialValues(res);\r\n      } catch {\r\n        if (!cancelled) message.error('Lỗi tải dữ liệu sản phẩm');\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [maCan]);\r\n\r\n  const onFinish = async (values: any) => {\r\n    await updateProductByMaCan(maCan, values);\r\n    message.success('Cập nhật sản phẩm thành công (mock)');\r\n    history.push(`/product/${maCan}`);\r\n    return true;\r\n  };\r\n\r\n  return (\r\n    <PageContainer\r\n      title=\"Sửa sản phẩm\"\r\n      onBack={() => history.push(`/product/${maCan}`)}\r\n      extra={[\r\n        <Button key=\"back\" onClick={() => history.push(`/product/${maCan}`)}>\r\n          Quay lại chi tiết\r\n        </Button>,\r\n      ]}\r\n    >\r\n      <Spin spinning={loading}>\r\n        {initialValues ? (\r\n          <ProCard>\r\n            <ProForm<Product>\r\n              layout=\"vertical\"\r\n              grid\r\n              colProps={{ span: 12 }}\r\n              initialValues={initialValues}\r\n              onFinish={onFinish}\r\n              submitter={{\r\n                searchConfig: { submitText: 'Cập nhật', resetText: 'Huỷ' },\r\n                resetButtonProps: {\r\n                  onClick: (e) => {\r\n                    e.preventDefault();\r\n                    history.push(`/product/${maCan}`);\r\n                  },\r\n                },\r\n              }}\r\n            >\r\n              {/* Mã căn: thường không cho sửa */}\r\n              <ProFormText\r\n                name=\"maCan\"\r\n                label=\"Mã căn\"\r\n                disabled\r\n                rules={[{ required: true, message: 'Vui lòng nhập mã căn' }]}\r\n              />\r\n\r\n              <ProFormText name=\"stt\" label=\"STT\" disabled />\r\n\r\n              <ProFormSelect\r\n                name=\"trangThai\"\r\n                label=\"Trạng thái\"\r\n                rules={[{ required: true, message: 'Vui lòng chọn trạng thái' }]}\r\n                valueEnum={{\r\n                  Available: { text: 'Available' },\r\n                  Sold: { text: 'Sold' },\r\n                }}\r\n              />\r\n\r\n              <ProFormText name=\"duAn\" label=\"Dự án\" rules={[{ required: true, message: 'Vui lòng nhập dự án' }]} />\r\n              <ProFormText name=\"dotBanHang\" label=\"Đợt bán hàng\" />\r\n              <ProFormText name=\"loaiSP\" label=\"Loại sản phẩm\" />\r\n              <ProFormText name=\"tang\" label=\"Tầng\" />\r\n              <ProFormText name=\"dienTich\" label=\"Diện tích\" placeholder=\"VD: 75 m2\" />\r\n\r\n              <ProFormText name=\"donGia\" label=\"Đơn giá\" placeholder=\"VD: 1,200,000\" />\r\n              <ProFormText name=\"tongGia\" label=\"Tổng giá\" placeholder=\"VD: 90,000,000\" />\r\n              <ProFormText name=\"chietKhau\" label=\"Chiết khấu\" placeholder=\"VD: 5%\" />\r\n              <ProFormText name=\"tongSauCK\" label=\"Tổng sau CK\" placeholder=\"VD: 85,500,000\" />\r\n            </ProForm>\r\n          </ProCard>\r\n        ) : null}\r\n      </Spin>\r\n    </PageContainer>\r\n  );\r\n};\r\n\r\nexport default ProductEdit;\r\n"],"names":[],"mappings":"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"}