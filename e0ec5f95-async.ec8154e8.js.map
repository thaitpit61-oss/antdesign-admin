{"version":3,"sources":["src/pages/project/forms/edit/index.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport {\r\n  PageContainer,\r\n  ProCard,\r\n  ProForm,\r\n  ProFormDatePicker,\r\n  ProFormSelect,\r\n  ProFormSwitch,\r\n  ProFormText,\r\n  ProFormTextArea,\r\n} from '@ant-design/pro-components';\r\nimport { Spin, message } from 'antd';\r\nimport { history, useParams } from '@umijs/max';\r\nimport dayjs from 'dayjs';\r\n\r\ntype ProjectForm = {\r\n  id: number;\r\n  tenBieuMau: string;\r\n  loaiBieuMau: string;\r\n  duAn: string;\r\n  dienGiai: string;\r\n  khoa: boolean;\r\n  nvTao: string;\r\n  ngayTao: string;\r\n  nvCapNhat: string;\r\n  ngayCapNhat: string;\r\n};\r\n\r\n// mock giống list của bạn\r\nconst MOCK_FORMS: ProjectForm[] = [\r\n  {\r\n    id: 1,\r\n    tenBieuMau: 'Phiếu khảo sát',\r\n    loaiBieuMau: 'Khảo sát khách hàng',\r\n    duAn: 'Dự án A',\r\n    dienGiai: 'Phiếu khảo sát chất lượng',\r\n    khoa: false,\r\n    nvTao: 'Nguyễn A',\r\n    ngayTao: '2025-05-10',\r\n    nvCapNhat: 'Trần B',\r\n    ngayCapNhat: '2025-06-01',\r\n  },\r\n  {\r\n    id: 2,\r\n    tenBieuMau: 'Phiếu đăng ký',\r\n    loaiBieuMau: 'Đăng ký tham gia',\r\n    duAn: 'Dự án B',\r\n    dienGiai: 'Phiếu đăng ký sự kiện',\r\n    khoa: true,\r\n    nvTao: 'Lê C',\r\n    ngayTao: '2025-06-01',\r\n    nvCapNhat: 'Lê C',\r\n    ngayCapNhat: '2025-06-02',\r\n  },\r\n];\r\n\r\nasync function fetchFormById(id: number): Promise<ProjectForm | null> {\r\n  await new Promise((r) => setTimeout(r, 200));\r\n  return MOCK_FORMS.find((x) => x.id === id) ?? null;\r\n}\r\n\r\nasync function updateForm(id: number, payload: Partial<ProjectForm>) {\r\n  await new Promise((r) => setTimeout(r, 200));\r\n  console.log('Update form', { id, payload });\r\n  return true;\r\n}\r\n\r\nconst ProjectFormEdit: React.FC = () => {\r\n  const params = useParams<{ id: string }>();\r\n  const formId = useMemo(() => Number(params.id), [params.id]);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [initialValues, setInitialValues] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    const run = async () => {\r\n      if (!Number.isFinite(formId) || formId <= 0) {\r\n        message.error('ID biểu mẫu không hợp lệ');\r\n        history.push('/project/forms');\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      try {\r\n        const res = await fetchFormById(formId);\r\n        if (cancelled) return;\r\n\r\n        if (!res) {\r\n          message.warning('Không tìm thấy biểu mẫu');\r\n          history.push('/project/forms');\r\n          return;\r\n        }\r\n\r\n        setInitialValues({\r\n          ...res,\r\n          ngayTao: res.ngayTao ? dayjs(res.ngayTao) : undefined,\r\n          ngayCapNhat: res.ngayCapNhat ? dayjs(res.ngayCapNhat) : undefined,\r\n        });\r\n      } catch {\r\n        if (!cancelled) message.error('Lỗi tải dữ liệu biểu mẫu');\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [formId]);\r\n\r\n  const onFinish = async (values: any) => {\r\n    const payload: Partial<ProjectForm> = {\r\n      ...values,\r\n      ngayTao: values.ngayTao ? values.ngayTao.format('YYYY-MM-DD') : '',\r\n      ngayCapNhat: values.ngayCapNhat ? values.ngayCapNhat.format('YYYY-MM-DD') : '',\r\n    };\r\n\r\n    await updateForm(formId, payload);\r\n    message.success('Cập nhật biểu mẫu thành công (mock)');\r\n    history.push(`/project/forms/${formId}`);\r\n    return true;\r\n  };\r\n\r\n  return (\r\n    <PageContainer title=\"Sửa biểu mẫu\" onBack={() => history.push(`/project/forms/${formId}`)}>\r\n      <Spin spinning={loading}>\r\n        {initialValues && (\r\n          <ProCard>\r\n            <ProForm\r\n              layout=\"vertical\"\r\n              grid\r\n              colProps={{ span: 12 }}\r\n              initialValues={initialValues}\r\n              onFinish={onFinish}\r\n              submitter={{\r\n                searchConfig: { submitText: 'Cập nhật', resetText: 'Huỷ' },\r\n                resetButtonProps: {\r\n                  onClick: (e) => {\r\n                    e.preventDefault();\r\n                    history.push(`/project/forms/${formId}`);\r\n                  },\r\n                },\r\n              }}\r\n            >\r\n              <ProFormText\r\n                name=\"tenBieuMau\"\r\n                label=\"Tên biểu mẫu\"\r\n                rules={[{ required: true, message: 'Vui lòng nhập tên biểu mẫu' }]}\r\n                colProps={{ span: 24 }}\r\n              />\r\n\r\n              <ProFormText name=\"loaiBieuMau\" label=\"Loại biểu mẫu\" />\r\n              <ProFormSelect\r\n                name=\"duAn\"\r\n                label=\"Dự án\"\r\n                valueEnum={{\r\n                  'Dự án A': { text: 'Dự án A' },\r\n                  'Dự án B': { text: 'Dự án B' },\r\n                }}\r\n              />\r\n\r\n              <ProFormTextArea\r\n                name=\"dienGiai\"\r\n                label=\"Diễn giải\"\r\n                colProps={{ span: 24 }}\r\n                fieldProps={{ rows: 4 }}\r\n              />\r\n\r\n              <ProFormSwitch\r\n                name=\"khoa\"\r\n                label=\"Khóa\"\r\n                fieldProps={{ checkedChildren: 'Khóa', unCheckedChildren: 'Hoạt động' }}\r\n              />\r\n\r\n              <ProFormText name=\"nvTao\" label=\"Nhân viên tạo\" />\r\n              <ProFormDatePicker name=\"ngayTao\" label=\"Ngày tạo\" fieldProps={{ format: 'YYYY-MM-DD' }} />\r\n\r\n              <ProFormText name=\"nvCapNhat\" label=\"Nhân viên cập nhật\" />\r\n              <ProFormDatePicker name=\"ngayCapNhat\" label=\"Ngày cập nhật\" fieldProps={{ format: 'YYYY-MM-DD' }} />\r\n            </ProForm>\r\n          </ProCard>\r\n        )}\r\n      </Spin>\r\n    </PageContainer>\r\n  );\r\n};\r\n\r\nexport default ProjectFormEdit;\r\n"],"names":[],"mappings":"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"}